<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.lsj.tingshu.account.mapper.UserAccountMapper">

	<resultMap id="userAccountMap" type="com.lsj.tingshu.model.account.UserAccount" autoMapping="true">
	</resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
		id,user_id,total_amount,lock_amount,available_amount,total_income_amount,total_pay_amount,create_time,update_time,is_deleted
	</sql>
	<update id="checkAndLockAmount">
        update user_account
        set user_account.lock_amount=user_account.lock_amount + #{amount},
            user_account.available_amount=user_account.available_amount - #{amount}
        WHERE user_account.user_id = #{userId}
          AND user_account.available_amount >= #{amount}

    </update>
    <update id="minus">
		update user_account
		set user_account.lock_amount=user_account.lock_amount - #{amount},
			user_account.total_amount=user_account.total_amount - #{amount},
			user_account.total_pay_amount=user_account.total_pay_amount+#{amount}
		WHERE user_account.user_id = #{userId}
	</update>
	<update id="unLock">
		update user_account
		set user_account.lock_amount=user_account.lock_amount - #{amount},
			user_account.available_amount=user_account.available_amount + #{amount}
		WHERE user_account.user_id = #{userId}

	</update>
    <update id="updateUserAmount">
		update user_account
		set user_account.total_amount=user_account.total_amount + #{amount},
			user_account.available_amount=user_account.available_amount + #{amount},
			user_account.total_income_amount=user_account.total_income_amount+#{amount}
		WHERE user_account.user_id = #{userId}

	</update>

</mapper>

